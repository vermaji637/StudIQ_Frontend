<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>findly â€” Profile</title>
  <link rel="stylesheet" href="../../css/userdashboard/styles.css">
</head>
<body>
  <aside class="sidebar">
    <div class="brand">
  <img src="../../images/findly-logo.png" alt="Findly Logo" class="brand-logo" />
</div>
    <ul class="nav-list">
      <li><a href="dashboardindex.html">Dashboard</a></li>
      <li class="active"><a href="profile.html">Profile</a></li>
      <li><a href="services.html">Services</a></li>
      <li><a href="bookings.html">Bookings</a></li>
      <li><a href="payment.html">Payment</a></li>
      <li><a href="settings.html">Settings</a></li>
      <li><a href="logout.html">Logout</a></li>
    </ul>
  </aside>

  <div class="main">
    <header class="page-header">
      <h1>Profile</h1>
    </header>

    <main class="content">
      <!-- View Mode -->
      <div id="view-mode">
        <section class="card">
          <div class="profile-header">
            <div>
              <h2>Vijay Kumar</h2>
              <p>Role: Student</p>
              <p>+91 9876543210</p>
            </div>
            <button class="btn" id="edit-profile-btn">Edit Profile</button>
          </div>
        </section>

        <section class="card">
          <h3>Personal Info</h3>
          <div class="info-grid">
            <div>
              <p><strong>First Name:</strong> <span id="view-first-name">Vijay</span></p>
              <p><strong>Username:</strong> vijayk</p>
              <p><strong>Mobile:</strong> +91 987654321</p>
              <p><strong>Email:</strong> vijay@example.com</p>
            </div>
            <div>
              <p><strong>Last Name:</strong> <span id="view-last-name">Kumar</span></p>
              <p><strong>Location:</strong> <span id="view-location">Indore, Madhya Pradesh</span></p>
              <p><strong>Date of Birth:</strong> <span id="view-dob">1995-05-15</span></p>
            </div>
          </div>
        </section>
      </div>

      <!-- Edit Mode (initially hidden) -->
      <div id="edit-mode" class="hidden">
        <section class="card profile-form">
          <h2>Edit Profile</h2>
          <form id="profile-form" method="POST" enctype="multipart/form-data">
            <div class="form-grid">
              <!-- Role (used to show/hide some dynamic fields) -->
              <!-- TIP: You can extend these options based on your app roles -->
              <div class="form-group">
                <label for="role">Role:</label>
                <select id="role" name="role" required>
                  <option value="">-- Select Role --</option>
                  <option value="owner">Owner</option>
                  <option value="admin">Admin</option>
                  <option value="agent">Agent</option>
                  <option value="user" selected>User</option>
                </select>
              </div>

              <!-- First & Last Name -->
              <div class="form-group">
                <label for="first_name">First Name:</label>
                <input type="text" id="first_name" name="first_name" value="Vijay" required>
              </div>
              
              <div class="form-group">
                <label for="last_name">Last Name:</label>
                <input type="text" id="last_name" name="last_name" value="Kumar" required>
              </div>

              <!-- Email & Mobile -->
              <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" id="email" name="email" value="vijay@example.com" required>
              </div>
              
              <div class="form-group">
                <label for="mobile">Mobile:</label>
                <input type="tel" id="mobile" name="mobile" value="+91 987654321" required>
              </div>

              <!-- State, District, City (choose in this order) -->
              <div class="form-group">
                <label for="state">State:</label>
                <select id="state" name="state" required>
                  <option value="">-- Select State --</option>
                  <!-- STATES LIST START -->
                  <!-- Add all your Indian states here. Example entries are shown: -->
                  <option value="Andhra Pradesh">Andhra Pradesh</option>
                  <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                  <option value="Assam">Assam</option>
                  <option value="Bihar">Bihar</option>
                  <option value="Chhattisgarh">Chhattisgarh</option>
                  <option value="Goa">Goa</option>
                  <option value="Gujarat">Gujarat</option>
                  <option value="Haryana">Haryana</option>
                  <option value="Himachal Pradesh">Himachal Pradesh</option>
                  <option value="Jharkhand">Jharkhand</option>
                  <option value="Karnataka">Karnataka</option>
                  <option value="Kerala">Kerala</option>
                  <option value="Madhya Pradesh" selected>Madhya Pradesh</option>
                  <option value="Maharashtra">Maharashtra</option>
                  <option value="Manipur">Manipur</option>
                  <option value="Meghalaya">Meghalaya</option>
                  <option value="Mizoram">Mizoram</option>
                  <option value="Nagaland">Nagaland</option>
                  <option value="Odisha">Odisha</option>
                  <option value="Punjab">Punjab</option>
                  <option value="Rajasthan">Rajasthan</option>
                  <option value="Sikkim">Sikkim</option>
                  <option value="Tamil Nadu">Tamil Nadu</option>
                  <option value="Telangana">Telangana</option>
                  <option value="Tripura">Tripura</option>
                  <option value="Uttar Pradesh">Uttar Pradesh</option>
                  <option value="Uttarakhand">Uttarakhand</option>
                  <option value="West Bengal">West Bengal</option>
                  <!-- Include UTs too if needed: Delhi, J&K, Ladakh, etc. -->
                  <!-- STATES LIST END -->
                </select>
              </div>
              
              <!-- District (populated from selected State) -->
              <div class="form-group">
                <label for="district">District:</label>
                <select id="district" name="district" required disabled>
                  <option value="">-- Select District --</option>
                </select>
              </div>

              <div class="form-group">
                <label for="city">City:</label>
                <input type="text" id="city" name="city" value="Indore" required disabled>
              </div>

              <!-- Date of Birth -->
              <div class="form-group">
                <label for="dob">Date of Birth:</label>
                <input type="date" id="dob" name="dob" value="1995-05-15">
              </div>

              <!-- Profile Picture -->
              <div class="form-group">
                <label for="profile_picture">Profile Picture:</label>
                <input type="file" id="profile_picture" name="profile_picture" accept="image/*">
              </div>

              <!-- Address -->
              <div class="form-group" style="grid-column: 1 / -1;">
                <label for="address">Address:</label>
                <input type="text" id="address" name="address" placeholder="House No, Street, Area" />
              </div>

              <!-- About -->
              <div class="form-group" style="grid-column: 1 / -1;">
                <label for="about">About Me:</label>
                <textarea id="about" name="about" rows="4">Student at University</textarea>
              </div>

              <!-- Aadhar Number -->
              <div class="form-group">
                <label for="aadhar_number">Aadhar Number:</label>
                <input type="text" id="aadhar_number" name="aadhar_number" maxlength="12" placeholder="12-digit Aadhar">
              </div>

              <!-- Extra Info -->
              <div class="form-group">
                <label for="extra_info">Extra Info:</label>
                <textarea id="extra_info" name="extra_info" rows="3" placeholder="Any additional details"></textarea>
              </div>

              <!-- Role based dynamic fields -->
              <!-- Shown when Role = owner -->
              <div class="form-group dynamic-field" id="hostel_college_field" style="display:none;">
                <label for="hostel_college">Hostel/College Name:</label>
                <input type="text" id="hostel_college" name="hostel_college" placeholder="Enter name">
              </div>

              <!-- Shown when Role = agent -->
              <div class="form-group dynamic-field" id="experience_field" style="display:none;">
                <label for="experience">Experience (years):</label>
                <input type="number" id="experience" name="experience" min="0" step="1" placeholder="0">
              </div>

              <!-- Form Actions -->
              <div class="form-actions">
                <button type="button" id="cancel-edit" class="btn btn-secondary">Cancel</button>
                <button type="submit" class="btn">Save Changes</button>
              </div>
            </div>
          </form>
        </section>
      </div>
    </main>
  </div>

  <script src="js/main.js"></script>
  <script>
    // Toggle between view and edit modes; support #edit in URL
    document.addEventListener('DOMContentLoaded', function() {
      const viewMode = document.getElementById('view-mode');
      const editMode = document.getElementById('edit-mode');
      const editBtn = document.getElementById('edit-profile-btn');
      const cancelBtn = document.getElementById('cancel-edit');
      const profileForm = document.getElementById('profile-form');
      
      // Field refs for dynamic behavior
      const roleSelect = document.getElementById('role');
      const hostelField = document.getElementById('hostel_college_field');
      const experienceField = document.getElementById('experience_field');
      const stateSelect = document.getElementById('state');
      const districtSelect = document.getElementById('district');

      function showEdit() {
        viewMode.classList.add('hidden');
        editMode.classList.remove('hidden');
        if (location.hash !== '#edit') location.hash = '#edit';
      }

      function showView() {
        editMode.classList.add('hidden');
        viewMode.classList.remove('hidden');
        if (location.hash) history.replaceState(null, '', location.pathname);
      }

      // Show edit mode
      editBtn.addEventListener('click', showEdit);

      // Cancel edit and return to view mode
      cancelBtn.addEventListener('click', showView);

      // Open edit mode automatically if URL has #edit
      function applyHashMode() {
        if (location.hash === '#edit') {
          showEdit();
        } else {
          showView();
        }
      }
      applyHashMode();
      window.addEventListener('hashchange', applyHashMode);

      // Role-based dynamic field visibility
      function applyRoleVisibility() {
        const role = roleSelect.value;
        hostelField.style.display = (role === 'owner') ? 'block' : 'none';
        experienceField.style.display = (role === 'agent') ? 'block' : 'none';
      }
      roleSelect.addEventListener('change', applyRoleVisibility);
      applyRoleVisibility(); // set initial state

      // State -> District mapping
      // IMPORTANT: Fill in the districts for each state you support.
      // Example shown for Arunachal Pradesh. Add the rest similarly.
      const stateDistricts = {
        // EXAMPLE:
        'Arunachal Pradesh': [
          'Anjaw','Changlang','Dibang Valley','East Kameng','East Siang','Kamle','Kra Daadi',
          'Kurung Kumey','Lepa Rada','Lohit','Longding','Lower Dibang Valley','Lower Siang','Lower Subansiri','Namsai',
          'Papum Pare','Shi Yomi','Tawang','Tirap','Upper Siang','Upper Subansiri','West Kameng','West Siang'
        ],
        // TODO: Add district arrays for all other states here, e.g.:
        // 'Madhya Pradesh': ['Indore','Bhopal','Jabalpur', ...],
        // 'Maharashtra': ['Mumbai City','Pune','Nagpur', ...],
        // 'Tamil Nadu': ['Chennai','Coimbatore','Madurai', ...],
        // 'Uttar Pradesh': ['Lucknow','Kanpur Nagar','Varanasi', ...],
        // ... and so on for each state in the dropdown
      };

      // Populate Districts when State changes
      function populateDistricts() {
        const state = stateSelect.value;
        // Reset options
        districtSelect.innerHTML = '<option value="">-- Select District --</option>';
        if (state && stateDistricts[state]) {
          stateDistricts[state].forEach(d => {
            const opt = document.createElement('option');
            opt.value = d;
            opt.textContent = d;
            districtSelect.appendChild(opt);
          });
          districtSelect.disabled = false; // enable when state selected
        } else {
          districtSelect.disabled = true; // disable when no state
        }
        // Whenever state changes, city should be disabled/reset until district picked
        cityInput.value = '';
        cityInput.disabled = true;
      }
      stateSelect.addEventListener('change', populateDistricts);
      populateDistricts(); // initial population if state preselected

      // Enable City only after a District is selected
      const cityInput = document.getElementById('city');
      function onDistrictChange() {
        if (districtSelect.value) {
          cityInput.disabled = false;
        } else {
          cityInput.value = '';
          cityInput.disabled = true;
        }
      }
      districtSelect.addEventListener('change', onDistrictChange);
      onDistrictChange();

      // Handle form submission
      profileForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Update view with new values
        document.getElementById('view-first-name').textContent = 
          document.getElementById('first_name').value;
        document.getElementById('view-last-name').textContent = 
          document.getElementById('last_name').value;
        document.getElementById('view-location').textContent = 
          `${document.getElementById('city').value}, ${document.getElementById('state').value}`;
        document.getElementById('view-dob').textContent = 
          document.getElementById('dob').value;
        
        // Switch back to view mode
        showView();
        
        // Here you would typically send the form data to the server
        // const formData = new FormData(profileForm);
        // fetch('/api/update-profile', { method: 'POST', body: formData })
        //   .then(response => response.json())
        //   .then(data => { 
        //     // Handle success 
        //     editMode.style.display = 'none';
        //     viewMode.style.display = 'block';
        //   })
        //   .catch(error => console.error('Error:', error));
      });
    });
  </script>
</body>
</html>